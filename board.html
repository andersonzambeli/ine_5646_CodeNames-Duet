<!DOCTYPE html>

<!--
    To do:
    - usar this.jogador_descobriu_todos e this.parceiro_descobriu_todos, para passar a vez direto
    - add botao passar a vez
    - criar bot simple e com IA externa
    - Ajustar habilatação com dos botões para disabilitar nos estados certos para o jogador(criar método bot_passa_vez?)


-->

<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
        <title>CodeNames:Duet - Grupo 5</title>
        <link rel="icon" type="image/x-icon" href="./favicon.ico">
        <link rel="stylesheet" href="./css/style.css">
    </head>








    <body>

        <div class="info_jogador">
            <h1>
                Jogador 1 está digitando a dica.
            </h1>
            
        </div>
        
        <div class="board" id="board">
            <script>
                class Game {

                    constructor(parent_element) { 
                        this.estado = 3; /* 0 - jogador 1 digita dica, 
                                            1 - jogador 2 escolhe as palavras no tabuleiro
                                            2 - jogador 2 digita dica
                                            3 - jogador 1 escolhe as palavras no tabuleiro*/
                        
                        this.joga_off = 0;
                        
                        this.tipo_jogo = 0; /* 0 - Jogo contra bot
                                            1 - jogo contra outro jogador*/
                        
                        this.bot_nivel = 1; /* 0 - bot fácil
                                            1 - bot difícil*/
                        
                        this.parent = parent_element;

                        this.jogador_descobriu_todos = 0;

                        this.parceiro_descobriu_todos = 0;

                        this.dica_atual={palavra: '', numero: 0}

                        this.partidas_passadas = 0

                        this.lista_de_palavras = [
                            { palavra: "amor", associadas: ["sentimento", "coração", "emoção"] },
                            { palavra: "amizade", associadas: ["confiança", "sentimento", "lealdade"] },
                            { palavra: "trabalho", associadas: ["esforço", "meta", "tempo"] },
                            { palavra: "escola", associadas: ["educação", "aprendizado", "professor"] },
                            { palavra: "professor", associadas: ["aula", "educação", "conhecimento"] },
                            { palavra: "aluno", associadas: ["escola", "aprendizado", "prova"] },
                            { palavra: "computador", associadas: ["tecnologia", "processador", "informação"] },
                            { palavra: "celular", associadas: ["tecnologia", "mensagem", "bateria"] },
                            { palavra: "internet", associadas: ["rede", "informação", "conexão"] },
                            { palavra: "livro", associadas: ["conhecimento", "leitura", "papel"] },
                            { palavra: "papel", associadas: ["escrita", "livro", "caneta"] },
                            { palavra: "caneta", associadas: ["escrita", "papel", "mão"] },
                            { palavra: "mão", associadas: ["toque", "escrita", "braço"] },
                            { palavra: "olho", associadas: ["visão", "rosto", "sentido"] },
                            { palavra: "ouvido", associadas: ["audição", "rosto", "sentido"] },
                            { palavra: "boca", associadas: ["fala", "rosto", "comida"] },
                            { palavra: "nariz", associadas: ["cheiro", "rosto", "ar"] },
                            { palavra: "ar", associadas: ["respiração", "vento", "nariz"] },
                            { palavra: "vento", associadas: ["ar", "frio", "clima"] },
                            { palavra: "frio", associadas: ["clima", "inverno", "vento"] },
                            { palavra: "calor", associadas: ["clima", "verão", "sol"] },
                            { palavra: "sol", associadas: ["luz", "calor", "dia"] },
                            { palavra: "lua", associadas: ["noite", "céu", "luz"] },
                            { palavra: "estrela", associadas: ["céu", "noite", "brilho"] },
                            { palavra: "céu", associadas: ["azul", "sol", "nuvem"] },
                            { palavra: "nuvem", associadas: ["chuva", "céu", "vento"] },
                            { palavra: "chuva", associadas: ["água", "nuvem", "clima"] },
                            { palavra: "rio", associadas: ["água", "peixe", "natureza"] },
                            { palavra: "mar", associadas: ["água", "areia", "onda"] },
                            { palavra: "praia", associadas: ["areia", "mar", "sol"] },
                            { palavra: "areia", associadas: ["praia", "grão", "solo"] },
                            { palavra: "floresta", associadas: ["árvore", "natureza", "animais"] },
                            { palavra: "árvore", associadas: ["folha", "tronco", "floresta"] },
                            { palavra: "folha", associadas: ["verde", "árvore", "vento"] },
                            { palavra: "terra", associadas: ["solo", "natureza", "planta"] },
                            { palavra: "planta", associadas: ["terra", "verde", "água"] },
                            { palavra: "flor", associadas: ["planta", "beleza", "colorido"] },
                            { palavra: "animal", associadas: ["vida", "natureza", "instinto"] },
                            { palavra: "cachorro", associadas: ["animal", "amizade", "fidelidade"] },
                            { palavra: "gato", associadas: ["animal", "independente", "casa"] },
                            { palavra: "pássaro", associadas: ["animal", "asa", "céu"] },
                            { palavra: "peixe", associadas: ["água", "animal", "mar"] },
                            { palavra: "carro", associadas: ["transporte", "motor", "rua"] },
                            { palavra: "ônibus", associadas: ["transporte", "cidade", "viagem"] },
                            { palavra: "avião", associadas: ["transporte", "céu", "viagem"] },
                            { palavra: "viagem", associadas: ["lazer", "avião", "descoberta"] },
                            { palavra: "cidade", associadas: ["rua", "prédio", "pessoas"] },
                            { palavra: "rua", associadas: ["cidade", "carro", "trânsito"] },
                            { palavra: "prédio", associadas: ["cidade", "janela", "andar"] },
                            { palavra: "casa", associadas: ["janela", "porta", "família"] },
                            { palavra: "porta", associadas: ["entrada", "fechadura", "casa"] },
                            { palavra: "janela", associadas: ["vidro", "casa", "vento"] },
                            { palavra: "família", associadas: ["amor", "casa", "união"] },
                            { palavra: "bebê", associadas: ["família", "vida", "criança"] },
                            { palavra: "criança", associadas: ["escola", "brincadeira", "família"] },
                            { palavra: "brinquedo", associadas: ["criança", "diversão", "plástico"] },
                            { palavra: "jogo", associadas: ["diversão", "regras", "competição"] },
                            { palavra: "bola", associadas: ["jogo", "esporte", "passe"] },
                            { palavra: "esporte", associadas: ["bola", "movimento", "corpo"] },
                            { palavra: "futebol", associadas: ["bola", "equipe", "gol"] },
                            { palavra: "equipe", associadas: ["trabalho", "união", "meta"] },
                            { palavra: "meta", associadas: ["trabalho", "objetivo", "planejamento"] },
                            { palavra: "tempo", associadas: ["relógio", "vida", "mudança"] },
                            { palavra: "relógio", associadas: ["tempo", "ponteiro", "pulso"] },
                            { palavra: "dia", associadas: ["sol", "tempo", "trabalho"] },
                            { palavra: "noite", associadas: ["lua", "sono", "escuro"] },
                            { palavra: "sono", associadas: ["cama", "noite", "descanso"] },
                            { palavra: "cama", associadas: ["sono", "travesseiro", "quarto"] },
                            { palavra: "quarto", associadas: ["cama", "porta", "luz"] },
                            { palavra: "luz", associadas: ["sol", "energia", "visão"] },
                            { palavra: "energia", associadas: ["luz", "eletricidade", "movimento"] },
                            { palavra: "movimento", associadas: ["corpo", "energia", "dança"] },
                            { palavra: "dança", associadas: ["música", "corpo", "movimento"] },
                            { palavra: "música", associadas: ["som", "arte", "emoção"] },
                            { palavra: "arte", associadas: ["cor", "música", "expressão"] },
                            { palavra: "pintura", associadas: ["arte", "cor", "tela"] },
                            { palavra: "tela", associadas: ["pintura", "computador", "imagem"] },
                            { palavra: "imagem", associadas: ["foto", "tela", "olho"] },
                            { palavra: "foto", associadas: ["imagem", "lembrança", "papel"] },
                            { palavra: "lembrança", associadas: ["foto", "emoção", "passado"] },
                            { palavra: "emoção", associadas: ["sentimento", "lembrança", "música"] },
                            { palavra: "história", associadas: ["passado", "livro", "lembrança"] },
                            { palavra: "passado", associadas: ["tempo", "história", "memória"] },
                            { palavra: "memória", associadas: ["passado", "mente", "lembrança"] },
                            { palavra: "mente", associadas: ["pensamento", "memória", "emoção"] },
                            { palavra: "pensamento", associadas: ["mente", "reflexão", "ideia"] },
                            { palavra: "ideia", associadas: ["criatividade", "pensamento", "inovação"] },
                            { palavra: "criatividade", associadas: ["arte", "ideia", "expressão"] },
                            { palavra: "expressão", associadas: ["emoção", "arte", "fala"] },
                            { palavra: "fala", associadas: ["voz", "palavra", "boca"] },
                            { palavra: "palavra", associadas: ["fala", "significado", "leitura"] },
                            { palavra: "leitura", associadas: ["palavra", "livro", "conhecimento"] },
                            { palavra: "conhecimento", associadas: ["leitura", "sabedoria", "educação"] },
                            { palavra: "educação", associadas: ["conhecimento", "escola", "valores"] },
                            { palavra: "valores", associadas: ["ética", "educação", "respeito"] },
                            { palavra: "respeito", associadas: ["valores", "amizade", "cidadania"] },
                            { palavra: "cidadania", associadas: ["respeito", "sociedade", "direitos"] },
                            { palavra: "sociedade", associadas: ["pessoas", "cidadania", "mundo"] },
                            { palavra: "mundo", associadas: ["vida", "sociedade", "planeta"] },
                            { palavra: "vida", associadas: ["mundo", "emoção", "existência"] }
                            ];

                        this.palavras_selecionadas = [];

                        this.palavras_jogador = [];

                        this.palavras_jogador_assassino = [];

                        this.palavras_jogador_clicadas = [];

                        this.palavras_jogador_acertadas = [];

                        
                        this.palavras_parceiro = [];

                        this.palavras_parceiro_assassino = [];

                        this.palavras_parceiro_clicadas = [];

                        this.palavras_parceiro_acertadas = [];


                        

                        this.click_elemento_board = this.click_elemento_board.bind(this);
                        this.click_elemento_enviar_dica = this.click_elemento_enviar_dica.bind(this)
                        this.click_elemento_passar_vez = this.click_elemento_passar_vez.bind(this)

                        this.criar_board();     
                        
                    }

                    check_palavra_parceiro_assassino(pos) {
                        if (this.palavras_parceiro_assassino.some(obj => obj.pos === pos)) {
                            console.log("Aqui")
                            return true
                        }
                        else{
                            return false
                        }
                    }

                    check_palavra_jogador_assassino(pos) {
                        if (this.palavras_jogador_assassino.some(obj => obj.pos === pos)) {
                            console.log("Aqui")
                            return true
                        }
                        else{
                            return false
                        }
                    }

                    
                    check_palavra_parceiro_certa(pos){
                        if (this.palavras_parceiro.some(obj => obj.pos === pos)) {

                            return true
                        }
                        else{
                            return false
                        }
                    }

                    check_palavra_jogador_certa(pos){
                        if (this.palavras_jogador.some(obj => obj.pos === pos)) {

                            return true
                        }
                        else{
                            return false
                        }
                    }

                    passar_para_proximo_estado(){    
                        this.estado = (this.estado + 1) % 4
                        console.log("Novo Estado") 
                        console.log(this.estado)    
                        let info_jogador = document.querySelector("div.info_jogador h1") 
                        let buttons = this.parent.getElementsByClassName("board-item")
                        let botao_dica = document.getElementsByClassName("botao_enviar_dica")
                        // console.log(botao_dica)             
                        switch(this.estado) {
                            case 0 :                               
                                info_jogador.textContent= "Jogador 1 está digitando a dica."                                
                                // console.log(buttons)
                                // for(const button of buttons){                                    
                                //     button.disabled = true;                                    
                                // }
                                // botao_dica[0].disabled = false
                                break

                            case 1:
                                
                                console.log(botao_dica)
                                // botao_dica[0].disabled = true
                                info_jogador.textContent= "Jogador 2 está adivinhando."
                                this.bot_adivinha()
                                break

                            case 2:
                                info_jogador.textContent= "Jogador 2 está digitando a dica."
                                this.bot_gera_dica()
                                break
                            
                            case 3:
                                info_jogador.textContent= "Jogador 1 está adivinhando."
                                for(const button of buttons){                                    
                                    button.disabled = false;                                    
                                }
                                break


                            
                            
                                

                        }
                        
                        
                    }



                    click_elemento_board(event){
                        const clickedElement = event.target.closest(".board-item");
                        // console.log(clickedElement.children)
                        let palavra_element = clickedElement.querySelector('.palavra_item')
                        console.log(palavra_element.textContent)
                        
                        let selecionado =  this.palavras_selecionadas.find(obj => obj.palavra == palavra_element.textContent)
                        console.log('Aqui Selecionado')
                        console.log(selecionado)
                        
                        if(this.estado == 3){

                            let status_bot = clickedElement.querySelector('.palavra_item_bot_acertado')
                            let loss = this.check_palavra_parceiro_assassino(selecionado.pos)
                            if (loss == true) {
                                alert("Vocẽ selecionou o Assassino e por isso vocês perderam o jogo!!!")
                                status_bot.textContent = "ASSASSINO"

                            }
                            else {
                                let acerto = this.check_palavra_parceiro_certa(selecionado.pos)
                                
                                if(acerto == true) {                                
                                    status_bot.textContent = "AGENTE"
                                    this.palavras_parceiro_acertadas.push(selecionado)
                                    this.palavras_parceiro_clicadas.push(selecionado)
                                    this.check_victory()

                                }
                                else{
                                    status_bot.textContent = "CIVIL"
                                    this.palavras_parceiro_clicadas.push(selecionado)
                                    this.passar_para_proximo_estado()

                                }

                            }



                        }


                        if(this.estado == 1){


                            let status_jogador = clickedElement.querySelector('.palavra_item_jogador_acertado')
                            let loss = this.check_palavra_jogador_assassino(selecionado.pos)
                            if (loss == true) {
                                alert("O parceiro selecionou o Assassino e por isso vocês perderam o jogo!!!")
                                status_jogador.textContent = "ASSASSINO"

                            }
                            else {
                                let acerto = this.check_palavra_jogador_certa(selecionado.pos)
                                
                                if(acerto == true) {                                
                                    status_jogador.textContent = "AGENTE"
                                    this.palavras_jogador_acertadas.push(selecionado)
                                    this.palavras_jogador_clicadas.push(selecionado)
                                    this.check_victory()

                                }
                                else{
                                    status_jogador.textContent = "CIVIL"
                                    this.palavras_jogador_clicadas.push(selecionado)
                                    this.passar_para_proximo_estado()

                                }

                            }



                        }

                                     

                    }

                    

                    click_elemento_enviar_dica(event){
                        const clickedElement = event.target.closest(".botao_enviar_dica");
                        
                        let parent = clickedElement.parentElement
                        console.log("Aqui2")
                        console.log(parent)
                        let input_palavra = parent.querySelector(".input_palavra")
                        let palavra = input_palavra.value
                        let input_numero = parent.querySelector(".input_numero")
                        let numero = input_numero.value
                        console.log(palavra, numero)
                        // console.log(this)
                        this.dica_atual["palavra"] = palavra
                        this.dica_atual["numero"] = numero
                        console.log(this.dica_atual)
                        let jogador_num = -1
                        if(this.estado == 0){
                            jogador_num = 1
                        }
                        else{
                            jogador_num = 2
                        }


                        let element_hist_dicas = document.querySelectorAll("div.historico-dicas pre")

                        console.log(element_hist_dicas[0].textContent)
                        element_hist_dicas[0].textContent = element_hist_dicas[0].textContent + `Jogador ${jogador_num}: Palavra ${this.dica_atual["palavra"]}, Quantidade ${this.dica_atual["numero"]} \n`


                        this.passar_para_proximo_estado()


                    }
                    
                    click_elemento_passar_vez(event){
                        this.passar_para_proximo_estado()                        
                    }


                    check_victory(){

                        if(this.palavras_jogador_acertadas.length == 7 && this.palavras_parceiro_acertadas.length == 7){

                            alert("Jogo Vencido")
                        }
                    }



                    

                    criar_board() {
                        
                        function pega_palavra_da_lista_e_confere(lista_de_palavras, lista_selecionada){
                            let randomIndex = Math.floor(Math.random() * lista_de_palavras.length);                            
                            let randomElement = lista_de_palavras[randomIndex];
                            // console.log(randomElement.palavra)
                            if (lista_selecionada.includes(randomElement)){
                                randomElement = pega_palavra_da_lista_e_confere(lista_de_palavras, lista_selecionada)
                            }
                            // console.log(randomElement)
                            return randomElement
                        }

                        // palavras geral
                        let palavras_board = []
                        for(let j = 0; j < 25; j++) {
                            let palavra =  pega_palavra_da_lista_e_confere(this.lista_de_palavras, palavras_board)
                            palavra["pos"] = j;
                            // console.log(palavra)
                            palavras_board.push(palavra)


                        }
                        this.palavras_selecionadas = palavras_board
                        
                        // Palavras do jogador
                        let jogador_palavras = []
                        for(let j = 0; j < 7; j++) {
                            
                            let palavra =  pega_palavra_da_lista_e_confere(this.palavras_selecionadas, jogador_palavras)
                            jogador_palavras.push(palavra)
                           
                        }
                        this.palavras_jogador = jogador_palavras

                        // palavras assassino jogador
                        let jogador_palavras_assassino = []
                        for(let j = 0; j < 1; j++) {
                            
                            let palavra =  pega_palavra_da_lista_e_confere(this.palavras_selecionadas, jogador_palavras)
                            jogador_palavras_assassino.push(palavra)
                           
                        }
                        this.palavras_jogador_assassino = jogador_palavras_assassino


                         // Palavras do parceiro
                        let parceiro_palavras = []
                        for(let j = 0; j < 7; j++) {
                            
                            let palavra =  pega_palavra_da_lista_e_confere(this.palavras_selecionadas, parceiro_palavras)
                            parceiro_palavras.push(palavra)
                           
                        }
                        this.palavras_parceiro = parceiro_palavras

                        // palavras assassino parceiro
                        let parceiro_palavras_assassino = []
                        for(let j = 0; j < 1; j++) {
                            
                            let palavra =  pega_palavra_da_lista_e_confere(this.palavras_selecionadas, parceiro_palavras)
                            parceiro_palavras_assassino.push(palavra)
                           
                        }
                        this.palavras_parceiro_assassino = parceiro_palavras_assassino




                        console.log(this.palavras_selecionadas)
                        console.log(this.palavras_jogador)
                        console.log(this.palavras_jogador_assassino)
                        console.log(this.palavras_parceiro)
                        console.log(this.palavras_parceiro_assassino)
                        
                        
                        // let json_lista = JSON.stringify(palavras_board)
                        // console.log(json_lista)
                        // let lista_parsed = JSON.parse(json_lista)
                        // // this.parent.setAttribute("data-board-Palavras", json_lista)
                        // // console.log(this.parent.dataset.boardPalavras)

                        


                        
            
                        // Cria os elementos do frid do board
                        for(let i = 0; i < 25; i++) {
                            const row = parseInt(i/5);
                            const col = i%5;
                            let item = document.createElement("button");
                            item.setAttribute("id", "b"+i);
                            item.setAttribute("class", "board-item");
                            
                            let palavra_item = document.createElement("p")
                            palavra_item.setAttribute("class", "palavra_item");
                            palavra_item.textContent = this.palavras_selecionadas[i].palavra;
                            item.append(palavra_item);

                            let palavra_item_jogador_acertado = document.createElement("p")                            
                            palavra_item_jogador_acertado.textContent = "?"
                            palavra_item_jogador_acertado.setAttribute("class", "palavra_item_jogador_acertado");
                            item.append(palavra_item_jogador_acertado);

                            let palavra_item_bot_acertado = document.createElement("p")
                            palavra_item_bot_acertado.setAttribute("class", "palavra_item_bot_acertado");
                            palavra_item_bot_acertado.textContent = "?"
                            item.append(palavra_item_bot_acertado);

                            item.addEventListener('click', this.click_elemento_board);

                            
                            this.parent.append(item)
                            
                            
                        }
                        // console.log(this.palavras_selecionadas)

                        


                    }

                    bot_adivinha(){

                        function selectTwoRandomElements(arr) {
                            if (arr.length == 0) {
                                
                                const randomIndex1 = Math.floor(Math.random() * arr.length);
                                return [];
                            }
                            if (arr.length == 1) {
                                
                                const randomIndex1 = Math.floor(Math.random() * arr.length);
                                return [arr[randomIndex1]];
                            }

                            const randomIndex1 = Math.floor(Math.random() * arr.length);
                            let randomIndex2 = Math.floor(Math.random() * arr.length);

                            // Ensure the two indices are different
                            while (randomIndex2 === randomIndex1) {
                                randomIndex2 = Math.floor(Math.random() * arr.length);
                            }

                            return [arr[randomIndex1], arr[randomIndex2]];
                        }

                        // Versão simples que usa vai seleciona direto as palavras do jogador
                        if (this.bot_nivel == 1){
                            let palavras  = []
                            let diferenca = this.palavras_jogador.filter(item => !this.palavras_jogador_acertadas.includes(item)).concat(this.palavras_jogador_acertadas.filter(item => !this.palavras_jogador.includes(item)));
                            console.log("Palavras que faltam o bot acertar")
                            console.log(diferenca)
                            palavras = selectTwoRandomElements(diferenca)
                            console.log(palavras.length)
                            if(palavras.length != 0){

                                    for(let i = 0; i< 2; i++){
                                    let id = palavras[i].pos
                                    let element_para_clicar = document.getElementById(`b${id}`)
                                    element_para_clicar.click()
                                    
                                    if(palavras.length == 1){
                                            break
                                        }

                                }

                                setTimeout(() => {
                                    
                                        this.passar_para_proximo_estado()

                                    }, 5000*1);

                            }
                            else{
                                // Se todas as palavras do jogador foram descobertas passa para próximo estado direto ---- Padronizar com a outra função
                                setTimeout(() => {
                                    
                                        this.passar_para_proximo_estado()

                                    }, 5000*1);

                            }

                        }

                    }

                    // Versão simple que joga uma palavra do parceiro
                    bot_gera_dica(){

                        if(this.bot_nivel == 1){

                            // Passa pro proximo estado se todas as palavras do parceiro já foram descobertas
                            if(this.palavras_parceiro_acertadas.length == 7){
                                this.passar_para_proximo_estado()
                            }
                            else{
                                let diferenca = this.palavras_parceiro.filter(item => !this.palavras_parceiro_acertadas.includes(item)).concat(this.palavras_parceiro_acertadas.filter(item => !this.palavras_parceiro.includes(item)));
                                let palavra = diferenca[Math.floor(Math.random() * diferenca.length)]
                                let input_palavra = document.querySelector(".input_palavra")
                                input_palavra.value = palavra["palavra"]
                                let input_numero = document.querySelector(".input_numero")
                                input_numero.value = 1
                                let botao_enviar_dica = document.querySelector(".botao_enviar_dica")
                                setTimeout(() => {
                                        
                                        botao_enviar_dica.click()

                                    }, 5000*1);
                            }                          
                        }
                    }                   


                }                 
                
            </script> 
        </div>    
        
        
        <div class="input-dica" id="input">
            <p>Digita a dica:</p>
            <input class="input_palavra", type="text">
            <p>Digite o número de palavras associadas a dica:</p>
            <input class="input_numero" type="text">
            <button class="botao_enviar_dica">Enviar Dica
            </button>

            <button class="botao_passar_vez">Passar Vez
            </button>
            

            

            
        </div>

        <div class="historico-dicas" id="historico">
            <p style="font-size: 18px;">Historico de dicas</p>
            <pre></pre>           
        </div>

        <script>
            let target = document.getElementById("board")
            const jogo = new Game(target)
            console.log()
            jogo.passar_para_proximo_estado()
        </script>
        <script>
            let botao_enviar_dica = document.getElementsByClassName("botao_enviar_dica");
            // console.log(botao_enviar_dica)
            botao_enviar_dica[0].addEventListener("click", jogo.click_elemento_enviar_dica)

        </script>

        <script>
            let botao_passar_vez = document.getElementsByClassName("botao_passar_vez");
            botao_passar_vez[0].addEventListener("click", jogo.click_elemento_passar_vez)
        </script>

        
    </body>
</html>